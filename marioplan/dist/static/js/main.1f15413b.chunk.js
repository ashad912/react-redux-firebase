(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{320:function(e,t,a){e.exports=a.p+"static/media/video.61e3654e.mp4"},326:function(e,t,a){e.exports=a(677)},331:function(e,t,a){},677:function(e,t,a){"use strict";a.r(t);var n,s=a(0),r=a.n(s),o=a(96),i=a.n(o),c=(a(331),a(9)),l=a(10),d=a(13),u=a(11),p=a(12),m=a(8),h=a(59),f=a(6),v=Object(f.b)(function(e){return{initials:e.firebase.profile.initials}},function(e){return{signOut:function(){return e(function(e,t,a){(0,a.getFirebase)().auth().signOut().then(function(){e({type:"SIGNOUT_SUCCESS"})})})}}})(function(e){return r.a.createElement("ul",{className:"right"},r.a.createElement("li",null,r.a.createElement(m.c,{to:"/create"},"New Project")),r.a.createElement("li",null,r.a.createElement(m.c,{to:"/canvas"},"Canvas")),r.a.createElement("li",null,r.a.createElement("a",{onClick:e.signOut},"Log Out"))," ",r.a.createElement("li",null,r.a.createElement(m.c,{to:"/",className:"btn btn-floating pink lighten-1"},e.initials)))}),g=function(){return r.a.createElement("ul",{className:"right"},r.a.createElement("li",null,r.a.createElement(m.c,{to:"/signup"},"Sign Up")),r.a.createElement("li",null,r.a.createElement(m.c,{to:"/signin"},"Login")))},E=Object(f.b)(function(e){return{auth:e.firebase.auth}})(function(e){var t=e.auth.uid?r.a.createElement(v,null):r.a.createElement(g,null);return r.a.createElement("nav",{className:"nav wrapper grey darken-3"},r.a.createElement("div",{className:"containter"},r.a.createElement(m.b,{to:"/",className:"brand-logo center"},"MarioPlan"),t))}),b=a(73),x=a.n(b),w=function(e){return r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"card z-depth-0"},r.a.createElement("div",{className:"card-content"},r.a.createElement("span",{className:"card-title"},"Notifications"),r.a.createElement("ul",null,e.notifications&&e.notifications.map(function(e){return r.a.createElement("li",{key:e.id}," ",r.a.createElement("span",{className:"pink-text"},e.user," "),r.a.createElement("span",null,e.content),r.a.createElement("div",{className:"grey-text note-date"},x()(e.time.toDate()).fromNow()))})))))},y=function(e){var t=e.project;return r.a.createElement("div",{className:"card z-depth-0 project-summary"},r.a.createElement("div",{className:"card-content grey-text text-darken-3"},r.a.createElement("span",{className:"card-title"},t.title),r.a.createElement("p",null,t.content),r.a.createElement("p",null,"Posted by the ",t.authorFirstName," ",t.authorLastName),r.a.createElement("p",{className:"grey-text"},x()(t.createdAt.toDate()).calendar())))},O=function(e){var t=e.projects,a=t?t.map(function(e){return r.a.createElement(m.b,{to:"/project/"+e.id,key:e.id}," ",r.a.createElement(y,{project:e})," ")}):r.a.createElement("span",null,"There is no projects my lord!");return r.a.createElement("div",{className:"project list section"},a)},N=a(320),S=a.n(N),j=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={dimensions:null,active:!1},a.handleResize=function(){a.setState({dimensions:{width:.87*a.container.offsetWidth,height:.87*a.container.offsetWidth*9/16}})},a.handleButton=function(){a.setState({active:!0})},a.renderVideo=function(){return r.a.createElement("video",{width:a.state.dimensions.width,height:a.state.dimensions.height,controls:!0},r.a.createElement("source",{src:S.a,type:"video/mp4"}))},a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.handleResize(),window.addEventListener("resize",this.handleResize)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleResize)}},{key:"render",value:function(){var e=this,t=this.state.active?null:r.a.createElement("div",{className:"input-field"},r.a.createElement("button",{className:"btn pink lighten-1 z-depth-0",onClick:this.handleButton},"Unlock your extra content"));return r.a.createElement("div",{className:"section",ref:function(t){return e.container=t}},r.a.createElement("div",{className:"card z-depth-0"},r.a.createElement("div",{className:"card-content"},r.a.createElement("span",{className:"card-title"},"Your extra content!"),r.a.createElement("ul",null,this.state.active&&this.state.dimensions&&this.renderVideo()),t)))}}]),t}(s.Component),P=a(42),C=a(28),k=function(e){function t(){return Object(c.a)(this,t),Object(d.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return this.props.auth.uid?(console.log(this.props),r.a.createElement("div",{className:"dashboard container"},r.a.createElement("div",{className:"row"}," ",r.a.createElement("div",{className:"col s12 m6"},r.a.createElement(O,{projects:this.props.projects}))," ",r.a.createElement("div",{className:"col s12 m5 offset-m1"},r.a.createElement(w,{notifications:this.props.notifications}),r.a.createElement(j,null))," "))):r.a.createElement(h.a,{to:"/signin"})}}]),t}(s.Component),M=Object(C.d)(Object(f.b)(function(e){return console.log(e),{projects:e.firestore.ordered.projects,auth:e.firebase.auth,notifications:e.firestore.ordered.notifications}}),Object(P.firestoreConnect)([{collection:"projects",orderBy:["createdAt","desc"]},{collection:"notifications",limit:3,orderBy:["time","desc"]}]))(k),I=Object(C.d)(Object(f.b)(function(e,t){var a=t.match.params.id,n=e.firestore.data.projects;return{project:n?n[a]:null,auth:e.firebase.auth}}),Object(P.firestoreConnect)([{collection:"projects"}]))(function(e){if(!e.auth.uid)return r.a.createElement(h.a,{to:"/signin"});console.log(e);var t=e.project;return t?r.a.createElement("div",{className:"container section project-details"},r.a.createElement("div",{className:"card z-depth-0"},r.a.createElement("div",{className:"card-content"},r.a.createElement("span",{className:"card-title"},t.title," "),r.a.createElement("p",null,t.content))),r.a.createElement("div",{className:"card-action grey lighten-4 grey-text"},r.a.createElement("div",null,t.authorFirstName," ",t.authorLastName),r.a.createElement("div",null,x()(t.createdAt.toDate()).calendar())," ")):r.a.createElement("div",{className:"container center"},r.a.createElement("p",null,"Loading project..."))}),R=a(46),A=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(d.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={email:"",password:""},a.handleChange=function(e){a.setState(Object(R.a)({},e.target.id,e.target.value))},a.handleSumbit=function(e){e.preventDefault(),a.props.signIn(a.state)},a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){if(this.props.auth.uid)return r.a.createElement(h.a,{to:"/"});var e=this.props.authError;return r.a.createElement("div",{className:"container"},r.a.createElement("form",{onSubmit:this.handleSumbit,className:"white"},r.a.createElement("h5",{className:"grey-text text-darken-3"},"Sign In"),r.a.createElement("div",{className:"input-field"}," ",r.a.createElement("label",{htmlFor:"email"},"Email"),r.a.createElement("input",{type:"email",id:"email",onChange:this.handleChange})),r.a.createElement("div",{className:"input-field"}," ",r.a.createElement("label",{htmlFor:"password"},"Password"),r.a.createElement("input",{type:"password",id:"password",onChange:this.handleChange})),r.a.createElement("div",{className:"input-field"},r.a.createElement("button",{className:"btn pink lighten-1 z-depth-0"},"Login"),r.a.createElement("div",{className:"red-text center"},e?r.a.createElement("p",null,e):null))))}}]),t}(s.Component),L=Object(f.b)(function(e){return{authError:e.auth.authError,auth:e.firebase.auth}},function(e){return{signIn:function(t){return e((a=t,function(e,t,n){(0,n.getFirebase)().auth().signInWithEmailAndPassword(a.email,a.password).then(function(){e({type:"LOGIN_SUCCESS"})}).catch(function(t){e({type:"LOGIN_ERROR",err:t})})}));var a}}})(A),_=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(d.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={email:"",password:"",firstName:"",lastName:""},a.handleChange=function(e){a.setState(Object(R.a)({},e.target.id,e.target.value))},a.handleSumbit=function(e){e.preventDefault(),a.props.signUp(a.state)},a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return this.props.auth.uid?r.a.createElement(h.a,{to:"/"}):r.a.createElement("div",{className:"container"},r.a.createElement("form",{onSubmit:this.handleSumbit,className:"white"},r.a.createElement("h5",{className:"grey-text text-darken-3"},"Sign Up"),r.a.createElement("div",{className:"input-field"}," ",r.a.createElement("label",{htmlFor:"email"},"Email"),r.a.createElement("input",{type:"email",id:"email",onChange:this.handleChange})),r.a.createElement("div",{className:"input-field"}," ",r.a.createElement("label",{htmlFor:"password"},"Password"),r.a.createElement("input",{type:"password",id:"password",onChange:this.handleChange})),r.a.createElement("div",{className:"input-field"}," ",r.a.createElement("label",{htmlFor:"firstName"},"First Name"),r.a.createElement("input",{type:"text",id:"firstName",onChange:this.handleChange})),r.a.createElement("div",{className:"input-field"}," ",r.a.createElement("label",{htmlFor:"lastName"},"Last Name"),r.a.createElement("input",{type:"text",id:"lastName",onChange:this.handleChange})),r.a.createElement("div",{className:"input-field"},r.a.createElement("button",{className:"btn pink lighten-1 z-depth-0"},"Sign Up"),r.a.createElement("div",{className:"red-text center"},this.props.authError?r.a.createElement("p",null,this.props.authError):null))))}}]),t}(s.Component),T=Object(f.b)(function(e){return{auth:e.firebase.auth,authError:e.auth.authError}},function(e){return{signUp:function(t){return e(function(e){return function(t,a,n){var s=n.getFirebase,r=n.getFirestore,o=s(),i=r();o.auth().createUserWithEmailAndPassword(e.email,e.password).then(function(t){return i.collection("users").doc(t.user.uid).set({firstName:e.firstName,lastName:e.lastName,initials:e.firstName[0]+e.lastName[0]})}).then(function(){t({type:"SIGNUP_SUCCESS"})}).catch(function(e){t({type:"SIGNUP_ERROR",err:e})})}}(t))}}})(_),U=a(24),z=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(d.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={title:"",content:""},a.handleChange=function(e){a.setState(Object(R.a)({},e.target.id,e.target.value))},a.handleSumbit=function(e){e.preventDefault(),a.props.createProject(a.state),a.props.history.push("/")},a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return this.props.auth.uid?r.a.createElement("div",{className:"container"},r.a.createElement("form",{onSubmit:this.handleSumbit,className:"white"},r.a.createElement("h5",{className:"grey-text text-darken-3"},"Create Project"),r.a.createElement("div",{className:"input-field"}," ",r.a.createElement("label",{htmlFor:"title"},"Title"),r.a.createElement("input",{type:"text",id:"title",onChange:this.handleChange})),r.a.createElement("div",{className:"input-field"}," ",r.a.createElement("label",{htmlFor:"content"},"Project Content"),r.a.createElement("textarea",{id:"content",className:"materialize-textarea",onChange:this.handleChange})),r.a.createElement("div",{className:"input-field"},r.a.createElement("button",{className:"btn pink lighten-1 z-depth-0"},"Create")))):r.a.createElement(h.a,{to:"/signin"})}}]),t}(s.Component),D=Object(f.b)(function(e,t){return{auth:e.firebase.auth}},function(e){return{createProject:function(t){return e(function(e){return function(t,a,n){n.getFirebase;var s=(0,n.getFirestore)(),r=a().firebase.profile,o=a().firebase.auth.uid;s.collection("projects").add(Object(U.a)({},e,{authorFirstName:r.firstName,authorLastName:r.lastName,authorId:o,createdAt:new Date})).then(function(){t({type:"CREATE_PROJECT",project:e})}).catch(function(e){t({type:"CREATE_PROJECT_ERROR",err:e})})}}(t))}}})(z),F=a(60),B=a(208),W=a.n(B),X=a(209),G=a.n(X),H=a(321),V=a.n(H),Y=a(322),J=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(d.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).handleMode=function(e,t){a.props.changeMode(t)},a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.mode,t=this.props.classes;return r.a.createElement("div",{className:t.toggleContainer},r.a.createElement(V.a,{value:e,exclusive:!0,onChange:this.handleMode},r.a.createElement(G.a,{value:"moving"},r.a.createElement("i",{class:"material-icons"},"open_with")),r.a.createElement(G.a,{value:"addition"},r.a.createElement("i",{class:"material-icons"},"touch_app"))))}}]),t}(s.Component),K=Object(f.b)(function(e,t){return{mode:e.canvas.mode}},function(e){return{changeMode:function(t){return e(function(e){return{type:"CHANGE_MODE",mode:e}}(t))}}})(Object(Y.withStyles)(function(e){return{toggleContainer:{height:56,padding:"".concat(e.spacing.unit,"px ").concat(2*e.spacing.unit,"px"),display:"flex",alignItems:"center",justifyContent:"flex-start",margin:"".concat(e.spacing.unit,"px 0")}}})(J)),Z=a(323),q=a.n(Z),Q=["image/png","image/jpeg","image/gif","image/bmp"],$=function(e){return-1===Q.indexOf(e.type)},ee=function(e){return r.a.createElement("label",null,r.a.createElement(q.a,{accept:"image/*",readAs:"dataUrl",onLoadStart:e.onLoadStart,onLoad:e.onLoad,cancelIf:$}),r.a.createElement("span",null))},te=function(e){var t=e.points,a=e.deletePoint,n=t?t.map(function(e){return r.a.createElement("div",{className:"point",key:e.id},r.a.createElement("div",{className:"card z-depth-0 project-summary"},r.a.createElement("div",{className:"card-content grey-text text-darken-3"},r.a.createElement("span",{className:"card-title"},e.name),r.a.createElement("p",null,"X = ",e.x),r.a.createElement("p",null,"Y = ",e.y),r.a.createElement("button",{className:"btn pink lighten-1 z-depth-0 right",onClick:function(){return a(e.id)}},"Delete"))))}):r.a.createElement("span",null,"There is no points!");return r.a.createElement("div",null,n)},ae=a(324),ne=a.n(ae),se=a(210),re=a(71),oe=Object(se.bindKeyboard)(Object(se.virtualize)(ne.a)),ie={padding:15,minHeight:100,color:"#fff"},ce={backgroundColor:"#FEA900"},le={backgroundColor:"#B3DC4A"},de={backgroundColor:"#6AC0FF"},ue=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={slideIndex:0},a.handleChangeSlideIndex=function(e){a.setState({slideIndex:e})},a.switchNewAppState=function(e){switch(e){case 0:a.props.updateAppState("position");break;case 1:a.props.updateAppState("tragus");break;case 2:a.props.updateAppState("correction");break;case 3:a.props.updateAppState("export");break;default:a.props.updateAppState("position")}},a.handleSlideBack=function(){var e=a.state.slideIndex,t=0!==e?e-1:e;a.switchNewAppState(t),a.setState({slideIndex:t})},a.handleSlideNext=function(){var e=a.state.slideIndex,t=3!==e?e+1:0;a.switchNewAppState(t),a.setState({slideIndex:t}),3===e&&a.setState({exported:!1})},a.handleDeletePoint=function(e){console.log(a.props),console.log("halo"),a.props.deletePoint(e)},a.newSample=function(){return r.a.createElement("button",{className:"btn pink lighten-1 z-depth-0 right",onClick:a.handleSlideNext},"New sample")},a.handleExport=function(){a.props.exportResults(a.props.results).then(function(){a.setState({exported:!0})})},a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.state.exported?r.a.createElement("div",null,"Export again"):r.a.createElement("div",null,"Export");return r.a.createElement("div",null,r.a.createElement(oe,{index:this.state.slideIndex,onChangeIndex:this.handleChangeSlideIndex,slideRenderer:function(a){var n,s=a.index,o=a.key,i=function(a){switch(a.index){default:return r.a.createElement("div",null,r.a.createElement("p",null,"Add two positioning points."),r.a.createElement(te,{points:e.props.positionPoints,deletePoint:e.handleDeletePoint}));case 1:return r.a.createElement("div",null,r.a.createElement("p",null,"Add point in the half height of the tragus."),r.a.createElement(te,{points:e.props.tragusPoints,deletePoint:e.handleDeletePoint}));case 2:return r.a.createElement("div",null,r.a.createElement("p",null,"Optionally, correct extreme ear points."),r.a.createElement("div",{className:"row"},r.a.createElement("button",{className:"btn pink lighten-1 z-depth-0 right",onClick:function(){return e.props.handleExtremes()}},"Compute extremes again")),r.a.createElement(te,{points:e.props.extremePoints,deletePoint:e.handleDeletePoint}));case 3:return r.a.createElement("div",null,r.a.createElement("p",null,"Export results to database."),r.a.createElement("div",{className:"card z-depth-0 project-summary"},r.a.createElement("div",{className:"card-content grey-text text-darken-3"},r.a.createElement("span",{className:"card-title"},"Results"),r.a.createElement("p",null,"Something: ",e.props.results.id),r.a.createElement("p",null,"Name:  ",e.props.results.name),r.a.createElement("button",{className:"btn pink lighten-1 z-depth-0 right",onClick:e.handleExport},t))))}}(a);switch(Object(re.mod)(s,3)){case 0:n=ce;break;case 1:n=le;break;case 2:n=de}var c=function(){switch(e.state.slideIndex){case 0:return 2===e.props.positionPoints.length;case 1:return 1===e.props.tragusPoints.length;case 2:return 2===e.props.extremePoints.length;case 3:return!1;default:return!0}}()?r.a.createElement("button",{className:"btn pink lighten-1 z-depth-0 right",onClick:e.handleSlideNext},"Next"):null,l=e.state.slideIndex>0?r.a.createElement("button",{className:"btn pink lighten-1 z-depth-0 left",onClick:e.handleSlideBack},"Back"):null;return r.a.createElement("div",{style:Object.assign({},ie,n),key:o},l,3===e.state.slideIndex&&e.state.exported&&e.newSample(),c,r.a.createElement("br",null),i)}}))}}]),t}(s.Component),pe=Object(f.b)(function(e){return{positionPoints:e.canvas.points.slice(0,2),tragusPoints:e.canvas.points.slice(2,3),extremePoints:e.canvas.points.slice(3,5),results:e.canvas.results}},function(e){return{updateAppState:function(t){return e(function(e){return function(t){return new Promise(function(a,n){t({type:"UPDATE_APP_STATE",appState:e}),a()})}}(t))},exportResults:function(t){return e(function(e){return function(t){return new Promise(function(a,n){t({type:"EXPORT_RESULTS",results:e}),a()})}}(t))}}})(ue),me=(a(297),a(595).Matrix),he=function(e){function t(){var e,a;Object(c.a)(this,t);for(var s=arguments.length,r=new Array(s),o=0;o<s;o++)r[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={ctx:null,canvasWidth:600,canvasHeight:800,myImg:null,points:[],theta:0,baseId:0,mode:"moving",canvasOffset:{x:0,y:0},lastClick:{x:0,y:0},selectedPoint:null,selectedPointName:null,pointisMoved:!1,movingEnded:!1,previousOffset:{x:0,y:0},imageLoaded:!1,scriptLoaded:!1},a.handleScriptLoad=function(){},a.handleOpenCVLoad=function(){a.setState({scriptLoaded:!0})},a.handleFileSelected=function(e,t,s){var r=new Image;r.src=e.target.result;window.URL.createObjectURL(t);r.onload=function(){a.props.updatePoints([]),a.setState({loading:!1,imageLoaded:!0,theta:0},function(){var e=a.refs.canvas,s=a.refs.newCanvas,o=e.getContext("2d");r.setAttribute("crossOrigin","anonymous");var i=r.width,c=r.height,l=r.width/r.height;console.log(r.height),r.height=a.state.canvasHeight-100,r.width=r.height*l,console.log(r.height);var d=(e.width-r.width)/2,u=(e.height-r.height)/2;a.setState({canvas:e,ctx:o,myImg:r,fileName:t.name,newCanvas:s,imageLoaded:!0,imageXRatio:i/r.width,imageYRatio:c/r.height,canvasOffsetXInit:d,canvasOffsetYInit:u},function(){o.fillStyle="grey",o.fillRect(0,0,e.width,e.height),o.drawImage(r,d,u,r.width,r.height),o.font="40px Courier",n=new me(a.state.ctx),console.log(a.props),a.state.scriptLoaded&&a.doThresholding()})})}},a.ctxMakeBackgroundAngImage=function(e,t){var n=a.state.ctx;n.clearRect(0,0,a.state.canvas.width,a.state.canvas.height),n.fillStyle="grey",n.fillRect(0,0,a.state.canvas.width,a.state.canvas.height),n.save(),n.translate(a.state.canvas.width/2+a.state.canvasOffset.x,a.state.canvas.height/2+a.state.canvasOffset.y),t?n.rotate(0):n.rotate(a.state.theta+e),n.translate(-(a.state.canvas.width/2+a.state.canvasOffset.x),-(a.state.canvas.height/2+a.state.canvasOffset.y)),n.drawImage(a.state.myImg,a.state.canvasOffsetXInit+a.state.canvasOffset.x,a.state.canvasOffsetYInit+a.state.canvasOffset.y,a.state.myImg.width,a.state.myImg.height),n.restore()},a.ctxMakePoint=function(e){var t=a.state.ctx;t.fillStyle="#c82124",t.beginPath(),t.arc(e.x,e.y,3,0,2*Math.PI),t.fill(),t.stroke(),t.save(),t.translate(e.x,e.y),t.fillStyle="red",t.font="bold "+Math.max(8,12)+"px Arial",t.fillText(e.name,3,-3),t.restore()},a.calculateAndCtxMakeLine=function(e,t){var n,s,r,o,i=a.state.ctx;if(null!=t){var c=e.x-t.x;if(console.log(c),0===c)r=e.x,o=t.x,n=0,s=a.state.canvas.height;else{var l=(e.y-t.y)/(e.x-t.x),d=e.y-l*e.x,u=a.state.canvas.width;n=d,s=l*u+d,r=0,o=u}}else r=0,o=a.state.canvas.width,n=e.y,s=e.y;i.beginPath(),i.moveTo(r,n),i.lineTo(o,s),i.stroke()},a.handleMouseDown=function(e){var t=a.getMousePos(a.state.canvas,e);if(t=a.toWorld(t.x,t.y),"addition"===a.props.mode){var n=!1,s=!1,r=[];switch(a.props.appState){case"position":n=(r=a.props.positionPoints).length>1;break;case"tragus":n=(r=a.props.tragusPoints).length>0;break;case"correction":n=(r=a.props.extremePoints).length>1;break;case"extreme":s=!0,n=!0;break;default:s=!0,n=!0}var o=!1;if(s||r.forEach(function(e){null!=e&&a.isBetween(t,e)&&(a.setState({selectedPoint:e.id,selectedPointName:e.name,pointIsMoved:!0}),o=!0,e.stroke="#F2C553")}),o)a.activateMove(e);else if(!n){var i={id:a.state.baseId+1,x:t.x,y:t.y,name:[]},c=[].concat(Object(F.a)(a.props.points),[i]);console.log(i),c=a.refreshNames(c),console.log(c[2]),a.ctxMakeBackgroundAngImage(0),c.forEach(function(e){null!=e&&a.ctxMakePoint(e)}),a.setState({baseId:a.state.baseId+1},function(){a.drawLines(c),a.props.updatePoints(c)})}}else"moving"===a.props.mode&&a.activateMove(e)},a.deleteLinesAndRefresh=function(){a.ctxMakeBackgroundAngImage(0),a.props.points.forEach(function(e){null!=e&&a.ctxMakePoint(e)})},a.deletePoint=function(e){a.ctxMakeBackgroundAngImage(0);var t=a.props.points.filter(function(t){return t.id!==e});(t=a.refreshNames(t)).forEach(function(e){null!=e&&a.ctxMakePoint(e)}),a.props.updatePoints(t)},a.handleRotate=function(){var e=a.props.positionPoints;if(2===e.length){var t=null,s=null;e[0].y>=e[1].y?(t=e[0],s=e[1]):(t=e[1],s=e[0]);var r=Math.atan(Math.abs(t.x-s.x)/Math.abs(t.y-s.y));t.x<s.x&&(r*=-1),console.log(r),a.ctxMakeBackgroundAngImage(r);var o=a.state.canvasOffset.x,i=a.state.canvasOffset.y;n.translate(a.state.canvas.width/2+o,a.state.canvas.height/2+i),n.rotate(r),n.translate(-(a.state.canvas.width/2+o),-(a.state.canvas.height/2+i));var c=n.applyToArray(a.props.points);console.log(c),n.reset();for(var l=[],d=0;d<c.length;d++){var u={id:a.props.points[d].id,x:c[d].x,y:c[d].y,name:a.props.points[d].name};l=[u].concat(Object(F.a)(l))}(l=a.refreshNames(l)).forEach(function(e){null!=e&&a.ctxMakePoint(e)}),a.setState({theta:r+a.state.theta},function(){a.props.updatePoints(l),a.doThresholding()})}},a.handleCenterRestore=function(){a.setState({canvasOffset:{x:0,y:0}},function(){a.ctxMakeBackgroundAngImage(null,!0);var e=a.state.previousOffset.x,t=a.state.previousOffset.y;n.translate(a.state.canvas.width/2+e,a.state.canvas.height/2+t),n.rotate(-a.state.theta),n.translate(-(a.state.canvas.width/2+e),-(a.state.canvas.height/2+t));var s=n.applyToArray(a.props.points);console.log(s),n.reset();for(var r=[],o=0;o<s.length;o++){var i={id:a.props.points[o].id,x:s[o].x-e,y:s[o].y-t,name:a.props.points[o].name};r=[].concat(Object(F.a)(r),[i])}(r=a.refreshNames(r)).forEach(function(e){null!=e&&a.ctxMakePoint(e)}),a.setState({theta:0,previousOffset:{x:0,y:0}},function(){a.props.updatePoints(r),a.doThresholding()})})},a.activateMove=function(e){var t=a.getMousePos(a.state.canvas,e),n={x:t.x-a.state.canvasOffset.x,y:t.y-a.state.canvasOffset.y};a.setState({lastClick:n,handleMouseMoveActive:!0})},a.handleMouseMove=function(e){if(a.state.handleMouseMoveActive){var t=a.getMousePos(a.state.canvas,e);if("addition"===a.props.mode&&a.state.pointIsMoved){a.ctxMakeBackgroundAngImage(0),t=a.toWorld(t.x,t.y);var n=a.props.points.filter(function(e){return e.id!==a.state.selectedPoint}),s={id:a.state.selectedPoint,x:t.x,y:t.y,name:a.state.selectedPointName};n=[].concat(Object(F.a)(n),[s]),(n=a.refreshNames(n)).forEach(function(e){null!=e&&a.ctxMakePoint(e)}),a.setState({},function(){a.props.updatePoints(n)})}else if("moving"===a.props.mode){var r={x:t.x-a.state.lastClick.x,y:t.y-a.state.lastClick.y};a.setState({canvasOffset:r,movingEnded:!1},function(){a.ctxMakeBackgroundAngImage(0);for(var e=a.state.canvasOffset.x-a.state.previousOffset.x,t=a.state.canvasOffset.y-a.state.previousOffset.y,n=[],s=0;s<a.props.points.length;s++){var r={id:a.props.points[s].id,x:a.props.points[s].x+e,y:a.props.points[s].y+t,name:a.props.points[s].name};n=[].concat(Object(F.a)(n),[r])}n.forEach(function(e){null!=e&&a.ctxMakePoint(e)}),n=a.refreshNames(n),a.setState({movingPoints:n},function(){return a.setState({movingEnded:!0})})})}}},a.handleMouseUp=function(e){if(a.state.handleMouseMoveActive){if("moving"===a.props.mode&&a.state.movingEnded){var t=a.state.movingPoints;a.doThresholding(),a.setState({previousOffset:a.state.canvasOffset},function(){"correction"===a.props.appState&&a.drawLines(t),a.props.updatePoints(t).then(function(){a.setState({movingPoints:null})})})}"addition"===a.props.mode&&"correction"===a.props.appState&&a.drawLines()}a.setState({handleMouseMoveActive:!1,pointIsMoved:!1,selectedPoint:null,selectedPointName:null,movingEnded:!1})},a.doThresholding=function(){var e=a.state.newCanvas.getContext("2d");e.clearRect(0,0,a.state.canvas.width,a.state.canvas.height),e.fillStyle="white",e.fillRect(0,0,a.state.canvas.width,a.state.canvas.height),e.save(),e.translate(a.state.canvas.width/2+a.state.canvasOffset.x,a.state.canvas.height/2+a.state.canvasOffset.y),e.rotate(a.state.theta),e.translate(-(a.state.canvas.width/2+a.state.canvasOffset.x),-(a.state.canvas.height/2+a.state.canvasOffset.y)),e.drawImage(a.state.myImg,a.state.canvasOffsetXInit+a.state.canvasOffset.x,a.state.canvasOffsetYInit+a.state.canvasOffset.y,a.state.myImg.width,a.state.myImg.height),e.restore();var t=window.cv.imread("newCanvas"),n=window.cv.Mat.zeros(t.rows,t.cols,window.cv.CV_8UC3);window.cv.cvtColor(t,t,window.cv.COLOR_RGBA2GRAY,0),window.cv.threshold(t,t,215,200,window.cv.THRESH_BINARY);var s=new window.cv.MatVector,r=new window.cv.MatVector,o=new window.cv.Mat,i=new window.cv.Mat;window.cv.findContours(t,r,i,window.cv.RETR_EXTERNAL,window.cv.CHAIN_APPROX_SIMPLE),window.cv.findContours(t,s,o,window.cv.RETR_CCOMP,window.cv.CHAIN_APPROX_SIMPLE),console.log("new");for(var c=0,l=0;l<r.size();++l)r.get(l).matSize[0]>32&&(console.log(r.get(l).matSize[0]),c++);console.log("Avoid: "+c);for(var d=c;d<s.size();++d)if(s.get(d).matSize[0]>32)if(console.log(s.get(d).matSize[0]),0===c){var u=new window.cv.Scalar(Math.round(255*Math.random()),Math.round(255*Math.random()),Math.round(255*Math.random()));window.cv.drawContours(n,s,d,u,0,window.cv.LINE_8,o,100)}else c--;window.cv.imshow("newCanvas",n),t.delete(),n.delete(),s.delete(),o.delete(),r.delete(),i.delete()},a.handleExtremes=function(){var e=function(e,t,a,n){var s=e.getImageData(t,a,1,1).data;return 0!==s[0]||0!==s[1]||0!==s[2]};if(a.state.imageLoaded&&a.state.scriptLoaded){var t,n,s=a.state.newCanvas.getContext("2d"),r=!1,o=a.props.points[2];a.props.points[0].y<a.props.points[1].y?(t=a.props.points[0],n=a.props.points[1]):(t=a.props.points[1],n=a.props.points[0]);var i,c,l=t.y-Math.abs(t.y-n.y),d=n.y+Math.abs(t.y-n.y),u=o.x>t.x?4:-4,p=t.x+u*Math.abs(o.x-t.x);console.log(p),console.log(l),console.log(d),u>0?(i=o.x,c=p):(i=p,c=o.x);for(var m=l;m<t.y;m+=1){for(var h=i;h<c;h+=1)if(e(s,h,m)){a.setState({extremeUp:{x:h,y:m}}),console.log(h),console.log(m),r=!0;break}if(r)break}r=!1,console.log("MaxX:"+p),console.log("PosUp.x: "+t.x);for(var f=d;f>=n.y;f-=1){for(var v=c;v>=i;v-=1)if(e(s,v,f)){a.setState({extremeDown:{x:v,y:f}}),console.log(v),console.log(f),r=!0;break}if(r)break}var g=Math.abs(o.y-f)/Math.abs(o.y-m),E=g>.42&&g<.72?"OK":"NOT OK";console.log("Scale: "+g),console.log(E);var b={id:a.state.baseId+1,x:h,y:m,name:"PE0"},x={id:a.state.baseId+2,x:v,y:f,name:"PE1"},w=[].concat(Object(F.a)(a.props.points.slice(0,3)),[x,b]);w=a.refreshNames(w),a.ctxMakeBackgroundAngImage(0),w.forEach(function(e){null!=e&&a.ctxMakePoint(e)}),a.setState({baseId:a.state.baseId+2},function(){a.props.updatePoints(w).then(function(){a.drawLines()})})}},a.drawLines=function(e){var t=e||a.props.points;5===t.length&&(a.calculateAndCtxMakeLine(t[0],t[1]),a.calculateAndCtxMakeLine(t[3],t[4]),a.calculateAndCtxMakeLine(t[2]),a.calculateAndCtxMakeLine(t[3]),a.calculateAndCtxMakeLine(t[4]))},a.refreshNames=function(e){return 1===e.length&&(e[0].name="POS_UP"),e.length>1&&(e[1].y>e[0].y?(e[0].name="POS_UP",e[1].name="POS_DOWN"):(e[1].name="POS_UP",e[0].name="POS_DOWN")),e.length>2&&(e[2].name="TR"),4===e.length&&(e[3].name="EX_UP"),e.length>4&&(e[4].y>e[3].y?(e[3].name="EX_UP",e[4].name="EX_DOWN"):(e[4].name="EX_UP",e[3].name="EX_DOWN")),e},a.getMousePos=function(e,t){var a=e.getBoundingClientRect();return{x:t.clientX-a.left,y:t.clientY-a.top}},a.toWorld=function(e,t){var a={x:e,y:t};return a=n.inverse(n).applyToPoint(a.x,a.y)},a.isBetween=function(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))<4.5},a.handleCompute=function(){var e={id:Math.round(255*Math.random()),name:"halo "+Math.round(255*Math.random())};a.props.updateResults(e)},a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){}},{key:"componentDidUpdate",value:function(){}},{key:"componentWillReceiveProps",value:function(e){var t=this;"position"===this.props.appState&&"tragus"===e.appState&&this.handleRotate(),"tragus"===this.props.appState&&"correction"===e.appState&&this.handleExtremes(),"correction"===this.props.appState&&"export"===e.appState&&this.handleCompute(),"export"===this.props.appState&&"position"===e.appState&&(this.setState({imageLoaded:!1,theta:0}),this.props.updatePoints([]),this.props.updateResults([])),"tragus"===this.props.appState&&"position"===e.appState&&this.props.updatePoints(this.props.points.slice(0,2)).then(function(){t.handleCenterRestore()}),"correction"===this.props.appState&&"tragus"===e.appState&&this.props.updatePoints(this.props.points.slice(0,3)).then(function(){t.deleteLinesAndRefresh()}),"export"===this.props.appState&&"correction"===e.appState&&this.props.updateResults([])}},{key:"render",value:function(){var e=this,t=this.state.imageLoaded,a="position"===this.props.appState?r.a.createElement(ee,{onLoadStart:function(){return e.setState({loading:!0})},onLoad:function(t,a){return e.handleFileSelected(t,a,0)},icon:this.state.mainFileIcon,fileName:this.state.fileName}):null,n=t&&"export"!==this.props.appState?r.a.createElement(K,null):null,s=t?r.a.createElement("div",null,r.a.createElement("div",{className:"canvases"},r.a.createElement("canvas",{id:"canvas",ref:"canvas",width:this.state.canvasWidth,height:this.state.canvasHeight,onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,onMouseMove:this.handleMouseMove}),r.a.createElement("canvas",{id:"newCanvas",ref:"newCanvas",width:this.state.canvasWidth,height:this.state.canvasHeight}))):r.a.createElement("div",{className:"com"},r.a.createElement("div",{className:"card z-depth-0 project-summary"},r.a.createElement("div",{className:"card-content grey-text text-darken-3"},r.a.createElement("span",{className:"card-title"},"Load the sample."))));t&&r.a.createElement("div",{className:"buttons"},r.a.createElement("div",{className:"row"},r.a.createElement("button",{className:"btn pink lighten-1 z-depth-0 right",onClick:this.handleRotate},"Rotate along two last points")),r.a.createElement("div",{className:"row"},r.a.createElement("button",{className:"btn pink lighten-1 z-depth-0 right",onClick:this.handleExtremes},"Compute extremes")),r.a.createElement("div",{className:"row"},r.a.createElement("button",{className:"btn pink lighten-1 z-depth-0 right",onClick:this.handleCenterRestore},"Restore to native position")));return r.a.createElement("div",{className:"dashboard container"},r.a.createElement(W.a,{url:"https://www.marvinj.org/releases/marvinj-0.7.js",onLoad:this.handleScriptLoad.bind(this)}),r.a.createElement(W.a,{url:"https://docs.opencv.org/4.1.0/opencv.js",onLoad:this.handleOpenCVLoad.bind(this)}),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col s12 m6"},a,n,s),r.a.createElement("div",{className:"col s12 m5 offset-m1"},r.a.createElement(pe,{handleExtremes:this.handleExtremes,deletePoint:this.deletePoint,handleExport:this.handleExport}))," "))}}]),t}(s.Component),fe=Object(f.b)(function(e){return{appState:e.canvas.appState,mode:e.canvas.mode,points:e.canvas.points,positionPoints:e.canvas.points.slice(0,2),tragusPoints:e.canvas.points.slice(2,3),extremePoints:e.canvas.points.slice(3,5)}},function(e){return{updatePoints:function(t){return e(function(e){return function(t){return new Promise(function(a,n){t({type:"UPDATE_POINTS",points:e}),a()})}}(t))},updateResults:function(t){return e(function(e){return function(t){return new Promise(function(a,n){t({type:"UPDATE_RESULTS",results:e}),a()})}}(t))}}})(he),ve=function(e){function t(){return Object(c.a)(this,t),Object(d.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement(m.a,null,r.a.createElement("div",{className:"App"},r.a.createElement(E,null),r.a.createElement(h.d,null,r.a.createElement(h.b,{exact:!0,path:"/",component:M}),r.a.createElement(h.b,{path:"/project/:id",component:I}),r.a.createElement(h.b,{path:"/signin",component:L}),r.a.createElement(h.b,{path:"/signup",component:T}),r.a.createElement(h.b,{path:"/create",component:D}),r.a.createElement(h.b,{path:"/canvas",component:fe}))))}}]),t}(s.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ge={authError:null},Ee=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ge,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOGIN_ERROR":return console.log("login error"),Object(U.a)({},e,{authError:"Login failed"});case"LOGIN_SUCCESS":return console.log("login success"),Object(U.a)({},e,{authError:null});case"LOGOUT_SUCCESS":return console.log("signout success"),e;case"SIGNUP_SUCCESS":return console.log("signup success"),Object(U.a)({},e,{authError:null});case"SIGNUP_ERROR":return console.log("signup error"),Object(U.a)({},e,{authError:t.err.message});default:return e}},be={projects:[{id:"1",title:"hehe1",content:"blaasasa"},{id:"2",title:"hehe2",content:"blaasasa"},{id:"3",title:"hehe3",content:"blaasasa"}]},xe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:be,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CREATE_PROJECT":return e;case"CREATE_PROJECT_ERROR":return console.log("create project error",t.err),e;default:return e}},we=a(99),ye={appState:"position",mode:"moving",points:[],results:[]},Oe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ye,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CHANGE_MODE":return Object(U.a)({},e,{mode:t.mode});case"UPDATE_POINTS":return Object(U.a)({},e,{points:t.points});case"UPDATE_APP_STATE":return Object(U.a)({},e,{appState:t.appState});case"UPDATE_RESULTS":return Object(U.a)({},e,{results:t.results});case"EXPORT_RESULTS":return Object(U.a)({},e);default:return e}},Ne=Object(C.c)({auth:Ee,project:xe,firestore:we.firestoreReducer,firebase:P.firebaseReducer,canvas:Oe}),Se=a(325),je=a(211),Pe=a.n(je);a(671),a(675);Pe.a.initializeApp({apiKey:"AIzaSyD0gZiNi1lZRdXvKN_WCt-jiwGiJVI-tVQ",authDomain:"ashad912-marioplan.firebaseapp.com",databaseURL:"https://ashad912-marioplan.firebaseio.com",projectId:"ashad912-marioplan",storageBucket:"ashad912-marioplan.appspot.com",messagingSenderId:"248850659528"});var Ce=Pe.a,ke=Object(C.e)(Ne,Object(C.d)(Object(C.a)(Se.a.withExtraArgument({getFirebase:P.getFirebase,getFirestore:we.getFirestore})),Object(we.reduxFirestore)(Ce),Object(P.reactReduxFirebase)(Ce,{useFirestoreForProfile:!0,userProfile:"users",attachAuthIsReady:!0})));ke.firebaseAuthIsReady.then(function(){i.a.render(r.a.createElement(f.a,{store:ke},r.a.createElement(ve,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})})}},[[326,1,2]]]);
//# sourceMappingURL=main.1f15413b.chunk.js.map